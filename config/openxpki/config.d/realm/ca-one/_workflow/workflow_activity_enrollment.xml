<!--
  Generated by: tools/scripts/ogflow.pl

     File: core/config/graffle/workflow_enrollment.graffle
      md5: 225771fdb669ea1b1bd0382cb91b6a3e

-->


<actions>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_INITIALIZE"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetSource"
            source="SCEP">
            <field name="_pkcs7" is_required="yes"/>
            <field name="_url_params"/>
            <field name="cert_profile"/>
            <field name="f_valid_csr"/>
            <field name="f_valid_scep_tid"/>
            <field name="pkcs10" is_required="yes"/>
            <field name="scep_tid" is_required="yes"/>
            <field name="server"/>
            <field name="signer_cert" is_required="yes"/>
            <field name="t_signer_cert_crypt_ok"/>
            <field name="t_signer_validity_ok"/>
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_DISAPPROVE"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"
            _map_notify_cc="$url_notifycc"
            _map_notify_to="$url_requester"
            _map_scep_tid="$scep_tid"
            message="scep_approval_rejected">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_DENY_AUTHENTICATION"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"
            _map_notify_cc="$url_notifycc"
            _map_notify_to="$url_requester"
            _map_scep_tid="$scep_tid"
            message="scep_auth_denied">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_ISSUE_CERT"
            class="OpenXPKI::Server::Workflow::Activity::NICE::IssueCertificate"
            retry_count="10"
            retry_interval="+0000000001">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_REVOKE_EXISTING_CERTS"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::RevokeExistingCerts">
    </action>


    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_ADD_AUTHENTICATION"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetContext"
            num_manual_authen="1">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_INVALIDATE_CHALLENGE_PASS"
            class="Workflow::Action::Null">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_PERSIST_CSR"
            class="OpenXPKI::Server::Workflow::Activity::CSR::PersistRequest">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_MODIFY_METADATA"
            class="Workflow::Action::Null">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_FETCH_GROUP_POLICY"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::FetchGroupPolicy">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_CLEAR_APPROVALS"
            class="OpenXPKI::Server::Workflow::Activity::Tools::CancelApprovals">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_CONTINUE_ISSUANCE"
            class="Workflow::Action::Null">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_ALLOW_RETRY"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Datapool::DeleteEntry"
            _map_ds_key_name="[% context.server %]:[% context.scep_tid %]"
            ds_namespace="scep.transaction_id">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_EXTRACT_CSR"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::ExtractCSR">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_FORK_PUBLISH"
            class="Workflow::Action::Null">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_GET_CERT_PROFILE"
            class="Workflow::Action::Null">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_CALC_APPROVALS"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::CalcApprovals">
            <field name="approval_points"/>
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_NOTIFY_CERT_ISSUED"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"
            _map_notify_cc="$url_notifycc"
            _map_notify_to="$url_requester"
            _map_scep_tid="$scep_tid"
            message="scep_cert_issued">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_NOTIFY_PENDING_APPROVAL"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"
            _map_notify_cc="$url_notifycc"
            _map_notify_to="$url_requester"
            _map_scep_tid="$scep_tid"
            message="scep_approval_pending">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_PERSIST_CERT_METADATA"
            class="OpenXPKI::Server::Workflow::Activity::Tools::PersistCertificateMetadata"
            _map_cust_id="$url_custid"
            _map_server_id="$server">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_EVAL_CHALLENGE"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::EvaluateChallenge">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_LOAD_RECENT_CERTIFICATE"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::LoadRecentCertificate">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_EVAL_ELIGIBILITY"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::EvaluateEligibility">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_EVAL_SIGNER_TRUST"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::EvaluateSignerTrust">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_FAIL"
            class="Workflow::Action::Null">
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_NEXT_CERT_TO_REVOKE"
            class="OpenXPKI::Server::Workflow::Activity::Tools::WFArray"
            array_name="tmp_queue"
            context_key="cert_identifier"
            function="shift">
            <field name="tmp_queue" is_required="yes"/>
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_REVOKE_CERT"
            class="OpenXPKI::Server::Workflow::Activity::Tools::RevokeCertificate"
            auto_approval="1"
            reason_code="superseded">
            <field name="cert_identifier" is_required="yes"/>
    </action>


    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_REVOKE_CERT_AFTER_REPLACE"
            class="OpenXPKI::Server::Workflow::Activity::Tools::RevokeCertificate"
            auto_approval="1"
            _map_cert_identifier="$replace_cert_identifier">
            <field name="replace_cert_identifier" is_required="yes"/>
            <field name="reason_code" is_required="yes"/>
            <field name="invalidity_time"/>
    </action>

    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_NULL1" class="Workflow::Action::Null"/>
    <action name="I18N_OPENXPKI_WF_ACTION_ENROLL_NULL2" class="Workflow::Action::Null"/>
</actions>
