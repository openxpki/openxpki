<!--
  Generated by: tools/scripts/ogflow.pl

     File: core/config/graffle/workflow_enrollment.graffle
      md5: 225771fdb669ea1b1bd0382cb91b6a3e

-->


<actions>

    <action name="enroll_initialize"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetSource"
            source="SCEP">
            <field name="_pkcs7" is_required="yes"/>
            <field name="_url_params"/>
            <field name="cert_profile"/>
            <field name="f_valid_csr"/>
            <field name="f_valid_scep_tid"/>
            <field name="pkcs10" is_required="yes"/>
            <field name="scep_tid" is_required="yes"/>
            <field name="server"/>
            <field name="signer_cert" is_required="yes"/>
            <field name="t_signer_cert_crypt_ok"/>
            <field name="t_signer_validity_ok"/>
    </action>

    <action name="enroll_disapprove"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"
            _map_notify_cc="$url_notifycc"
            _map_notify_to="$url_requester"
            _map_scep_tid="$scep_tid"
            message="scep_approval_rejected">
    </action>

    <action name="enroll_deny_authentication"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"
            _map_notify_cc="$url_notifycc"
            _map_notify_to="$url_requester"
            _map_scep_tid="$scep_tid"
            message="scep_auth_denied">
    </action>

    <action name="enroll_issue_cert"
            class="OpenXPKI::Server::Workflow::Activity::NICE::IssueCertificate"
            retry_count="10"
            retry_interval="+0000000001">
    </action>

    <action name="enroll_revoke_existing_certs"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::RevokeExistingCerts">
    </action>


    <action name="enroll_add_authentication"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetContext"
            num_manual_authen="1">
    </action>

    <action name="enroll_invalidate_challenge_pass"
            class="Workflow::Action::Null">
    </action>

    <action name="enroll_persist_csr"
            class="OpenXPKI::Server::Workflow::Activity::CSR::PersistRequest">
    </action>

    <action name="enroll_modify_metadata"
            class="Workflow::Action::Null">
    </action>

    <action name="enroll_fetch_group_policy"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::FetchGroupPolicy">
    </action>

    <action name="enroll_clear_approvals"
            class="OpenXPKI::Server::Workflow::Activity::Tools::CancelApprovals">
    </action>

    <action name="enroll_continue_issuance"
            class="Workflow::Action::Null">
    </action>

    <action name="enroll_allow_retry"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Datapool::DeleteEntry"
            _map_ds_key_name="[% context.server %]:[% context.scep_tid %]"
            ds_namespace="scep.transaction_id">
    </action>

    <action name="enroll_extract_csr"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::ExtractCSR">
    </action>

    <action name="enroll_fork_publish"
            class="Workflow::Action::Null">
    </action>

    <action name="enroll_get_cert_profile"
            class="Workflow::Action::Null">
    </action>

    <action name="enroll_calc_approvals"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::CalcApprovals">
            <field name="approval_points"/>
    </action>

    <action name="enroll_notify_cert_issued"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"
            _map_notify_cc="$url_notifycc"
            _map_notify_to="$url_requester"
            _map_scep_tid="$scep_tid"
            message="scep_cert_issued">
    </action>

    <action name="enroll_notify_pending_approval"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"
            _map_notify_cc="$url_notifycc"
            _map_notify_to="$url_requester"
            _map_scep_tid="$scep_tid"
            message="scep_approval_pending">
    </action>

    <action name="enroll_persist_cert_metadata"
            class="OpenXPKI::Server::Workflow::Activity::Tools::PersistCertificateMetadata"
            _map_cust_id="$url_custid"
            _map_server_id="$server">
    </action>

    <action name="enroll_eval_challenge"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::EvaluateChallenge">
    </action>

    <action name="enroll_load_recent_certificate"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::LoadRecentCertificate">
    </action>

    <action name="enroll_eval_eligibility"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::EvaluateEligibility">
    </action>

    <action name="enroll_eval_signer_trust"
            class="OpenXPKI::Server::Workflow::Activity::SCEPv2::EvaluateSignerTrust">
    </action>

    <action name="enroll_fail"
            class="Workflow::Action::Null">
    </action>

    <action name="enroll_next_cert_to_revoke"
            class="OpenXPKI::Server::Workflow::Activity::Tools::WFArray"
            array_name="tmp_queue"
            context_key="cert_identifier"
            function="shift">
            <field name="tmp_queue" is_required="yes"/>
    </action>

    <action name="enroll_revoke_cert"
            class="OpenXPKI::Server::Workflow::Activity::Tools::RevokeCertificate"
            auto_approval="1"
            reason_code="superseded">
            <field name="cert_identifier" is_required="yes"/>
    </action>


    <action name="enroll_revoke_cert_after_replace"
            class="OpenXPKI::Server::Workflow::Activity::Tools::RevokeCertificate"
            auto_approval="1"
            _map_cert_identifier="$replace_cert_identifier">
            <field name="replace_cert_identifier" is_required="yes"/>
            <field name="reason_code" is_required="yes"/>
            <field name="invalidity_time"/>
    </action>

    <action name="enroll_null1" class="Workflow::Action::Null"/>
    <action name="enroll_null2" class="Workflow::Action::Null"/>
</actions>
